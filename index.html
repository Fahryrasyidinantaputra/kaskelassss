<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kas Kelas UBP ‚Äî Dashboard</title>
  <link rel="icon" href="assets/logo.png" />
  <link rel="stylesheet" href="style.css" />

  <!-- Libs -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
  <!-- Guard -->
  <script>
    const __user = JSON.parse(localStorage.getItem('activeUser')||'null');
    if(!__user) location.replace('login.html');
  </script>

  <!-- Sidebar -->
  <aside class="sidebar">
    <h2>Kas Kelas UBP</h2>
    <a class="navlink active" data-section="dashboard">üè† Dashboard</a>
    <a class="navlink" data-section="transaksi">üí∞ Transaksi</a>
    <a class="navlink" data-section="qris">üì± QRIS</a>
    <a class="navlink" data-section="laporan">üìä Laporan</a>
    <a class="navlink" data-section="aktivitas">üìã Aktivitas</a>
    <div class="logout-btn" onclick="logout()">Keluar</div>
  </aside>

  <!-- Main -->
  <main class="main">
    <div class="header-flex">
      <div>
        <h1 style="margin:0">Dashboard Kas</h1>
        <div id="permNote" class="muted">‚Äî</div>
      </div>
      <div class="header-right">
        <select id="themePicker" class="theme-picker">
          <option value="blue" selected>Blue</option>
          <option value="indigo">Indigo</option>
          <option value="teal">Teal</option>
        </select>
        <div class="user-pill" id="userBadge">‚Äî</div>
      </div>
    </div>

    <!-- DASHBOARD -->
    <section id="dashboard" class="section active">
      <div class="grid-3">
        <div class="card kpi"><h3>Saldo</h3><div class="val" id="sumSaldo">Rp 0</div></div>
        <div class="card kpi"><h3>Pemasukan</h3><div class="val" id="sumIn">Rp 0</div></div>
        <div class="card kpi"><h3>Pengeluaran</h3><div class="val" id="sumOut">Rp 0</div></div>
      </div>

      <div class="two-col">
        <div class="card">
          <h3 style="margin-bottom:10px">Rasio Pemasukan vs Pengeluaran</h3>
          <div class="chart-wrap"><canvas id="miniChart"></canvas></div>
        </div>
        <div class="card">
          <h3 style="margin-bottom:10px">Tren Saldo</h3>
          <div class="chart-wrap" style="height:300px"><canvas id="trendChart"></canvas></div>
        </div>
      </div>
    </section>

    <!-- TRANSAKSI -->
    <section id="transaksi" class="section">
      <div class="card">
        <div class="toolbar">
          <h2 style="margin:0">Transaksi</h2>
          <div class="grow"></div>
          <input id="searchBox" placeholder="Cari transaksi..." />
          <button id="btnExportXls" class="btn btn-secondary">Export Excel</button>
          <button id="btnExportPdf" class="btn btn-primary">Export PDF</button>
        </div>

        <div id="formTransaksi" class="form-grid">
          <input id="nama" placeholder="Nama" />
          <select id="tipe"><option value="pemasukan">Pemasukan</option><option value="pengeluaran">Pengeluaran</option></select>
          <select id="kategori">
            <option>Kas Rutin</option><option>Donasi</option><option>QRIS</option><option>Lainnya</option>
          </select>
          <input id="keterangan" placeholder="Keterangan (opsional)" />
          <input id="jumlah" type="number" min="0" placeholder="Jumlah (Rp)" />
          <button class="btn btn-primary" type="button" onclick="tambahTransaksi()">Tambah</button>
        </div>

        <div class="table-container">
          <table class="table">
            <thead>
              <tr>
                <th>Tanggal</th><th>Nama</th><th>Tipe</th><th>Kategori</th><th>Keterangan</th><th>Jumlah</th><th id="aksiHead">Aksi</th>
              </tr>
            </thead>
            <tbody id="tabelKasBody"></tbody>
          </table>
        </div>

        <div id="totalKategori" class="muted" style="margin-top:10px"></div>
      </div>
    </section>

    <!-- QRIS -->
    <section id="qris" class="section">
      <div class="two-col">
        <div class="card">
          <h2 style="margin:0 0 6px">Pembayaran via QRIS</h2>
          <p class="muted">Upload bukti (opsional) untuk mempercepat verifikasi admin.</p>
          <div class="form-grid">
            <input id="qrisNama" placeholder="Nama Pembayar" />
            <input id="qrisNominal" type="number" min="0" placeholder="Nominal (Rp)" />
            <input id="qrisKeterangan" placeholder="Keterangan (opsional)" />
            <input id="qrisBukti" type="file" accept="image/*" />
            <button class="btn btn-primary" type="button" onclick="ajukanQRIS()">Saya Sudah Bayar</button>
          </div>
        </div>

        <div class="card">
          <h3 style="margin:0 0 8px">Menunggu Konfirmasi Admin</h3>
          <div class="table-container">
            <table class="table">
              <thead><tr><th>Nama</th><th>Nominal</th><th>Keterangan</th><th>Bukti</th><th>Status</th><th>Aksi</th></tr></thead>
              <tbody id="pendingBody"></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- LAPORAN -->
    <section id="laporan" class="section">
      <div class="card">
        <div class="toolbar">
          <h2 style="margin:0">Laporan</h2>
          <div class="grow"></div>
          <button id="btnExportXls2" class="btn btn-secondary">Export Excel</button>
          <button id="btnExportPdf2" class="btn btn-primary">Export PDF</button>
        </div>
        <div class="table-container">
          <table class="table">
            <thead><tr><th>Tanggal</th><th>Nama</th><th>Kategori</th><th>Pemasukan</th><th>Pengeluaran</th><th>Saldo Hari Itu</th></tr></thead>
            <tbody id="rekapBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- AKTIVITAS -->
    <section id="aktivitas" class="section">
      <div class="card">
        <h2 style="margin:0 0 10px">Log Aktivitas</h2>
        <div id="aktivitasList" class="log-list"></div>
      </div>
    </section>
  </main>

  <script src="firebase.js"></script>
  <script src="script.js"></script>
</body>
</html>
