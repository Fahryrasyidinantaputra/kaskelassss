<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Kas Kelas</title>
  <link rel="stylesheet" href="style.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    if (!localStorage.getItem('kk_active_user')) {
      location.replace('login.html');
    }
  </script>
</head>
<body>
  <!-- ===== AUTH OVERLAY (Login / Sign Up) ===== -->
  <div id="authOverlay" class="overlay">
    <div class="auth-card">
      <div class="auth-tabs">
        <button class="tab active" data-tab="loginPanel">Masuk</button>
        <button class="tab" data-tab="signupPanel">Daftar</button>
      </div>
      <div id="loginPanel" class="tab-panel active">
        <h3>Masuk</h3>
        <input id="loginUser" placeholder="Username"/>
        <input id="loginPass" placeholder="Password" type="password"/>
        <button class="primary" onclick="login()">Masuk</button>
      </div>
      <div id="signupPanel" class="tab-panel">
        <h3>Daftar</h3>
        <input id="regUser" placeholder="Username"/>
        <input id="regPass" placeholder="Password" type="password"/>
        <p class="muted">Akun baru otomatis ber-role <b>anggota</b>.</p>
        <button class="primary" onclick="register()">Buat Akun</button>
      </div>
    </div>
  </div>

  <div class="app">
    <!-- ===== SIDEBAR ===== -->
    <aside class="sidebar">
      <h2>Kas Kelas</h2>
      <nav>
        <button class="navlink active" data-section="dashboard">🏠 Dashboard</button>
        <button class="navlink" data-section="transaksi">💰 Transaksi</button>
        <button class="navlink" data-section="qris">📱 QRIS</button>
        <button class="navlink" data-section="laporan">📊 Laporan</button>
      </nav>
      <div class="userbox">
        <div class="badge" id="userBadge">—</div>
        <button class="danger outline" onclick="logout()">Keluar</button>
      </div>
    </aside>

    <!-- ===== MAIN ===== -->
    <main class="main">
      <!-- ===== DASHBOARD ===== -->
      <section id="dashboard" class="section active">
        <div class="topbar">
          <h1>Dashboard Kas Kelas</h1>
          <div class="saldo-pill">Saldo: <span id="saldoHeader">Rp 0</span></div>
        </div>
        <p id="permNote" class="muted"></p>

        <div class="cards-3">
          <div class="card k-saldo">
            <span class="k-label">Saldo Saat Ini</span>
            <div class="k-value" id="sumSaldo">Rp 0</div>
            <div class="k-desc">Saldo terkini dari semua transaksi</div>
          </div>
          <div class="card k-metric">
            <span class="k-label">Pemasukan</span>
            <div class="k-value" id="sumIn">Rp 0</div>
          </div>
          <div class="card k-metric">
            <span class="k-label">Pengeluaran</span>
            <div class="k-value" id="sumOut">Rp 0</div>
          </div>
        </div>

        <div class="cards-2">
          <div class="card k-metric">
            <span class="k-label">Transaksi Bulan Ini</span>
            <div class="k-value" id="countThisMonth">0</div>
          </div>
          <div class="card chart-card">
            <div class="chart-head">Rasio Kas</div>
            <div class="chart-wrap">
              <canvas id="miniChart"></canvas>
            </div>
            <div class="legend-row">
              <span class="dot dot-in"></span> Pemasukan
              <span class="dot dot-out"></span> Pengeluaran
            </div>
          </div>
        </div>
      </section>

      <!-- ===== TRANSAKSI ===== -->
      <section id="transaksi" class="section">
        <h2>Tambah Transaksi</h2>
        <div id="formTransaksi" class="form-grid">
          <input id="nama" placeholder="Nama"/>
          <select id="tipe">
            <option value="pemasukan">Pemasukan</option>
            <option value="pengeluaran">Pengeluaran</option>
          </select>
          <input id="kategori" placeholder="Kategori (Kas Rutin/Donasi/...)"/>
          <input id="keterangan" placeholder="Keterangan"/>
          <input id="jumlah" type="number" placeholder="Jumlah (Rp)"/>
          <button class="primary" onclick="tambahTransaksi()">Simpan</button>
        </div>

        <h3>Daftar Transaksi</h3>
        <div class="table-wrap">
          <table>
            <thead>
              <tr>
                <th>Tanggal</th>
                <th>Nama</th>
                <th>Tipe</th>
                <th>Kategori</th>
                <th>Keterangan</th>
                <th>Jumlah</th>
                <th id="aksiHead">Aksi</th>
              </tr>
            </thead>
            <tbody id="tabelKasBody"></tbody>
          </table>
        </div>
      </section>

      <!-- ===== QRIS ===== -->
      <section id="qris" class="section">
        <h2>Pembayaran via QRIS (DANA)</h2>
        <div class="qris-container">
          <div class="qris-left">
            <img src="assets/qris-placeholder.png" alt="QRIS DANA" class="qris-image">
            <p class="muted">*Scan QR DANA ini menggunakan aplikasi DANA untuk membayar kas kelas.</p>
          </div>
          <div class="qris-right">
            <h3>Form Pembayaran</h3>
            <input id="qrisNama" placeholder="Nama Pembayar">
            <input id="qrisNominal" type="number" placeholder="Nominal (Rp)">
            <input id="qrisKeterangan" placeholder="Keterangan (opsional)">
            <button class="primary" onclick="ajukanQRIS()">Saya Sudah Bayar</button>
          </div>
        </div>

        <div class="panel">
          <h4>Daftar Pembayaran Pending</h4>
          <table>
            <thead>
              <tr>
                <th>Nama</th>
                <th>Nominal</th>
                <th>Keterangan</th>
                <th>Status</th>
                <th>Aksi</th>
              </tr>
            </thead>
            <tbody id="pendingBody"></tbody>
          </table>
        </div>
        Alur: anggota membuat permintaan → status <b>Pending</b> → admin menekan <b>Konfirmasi</b> → transaksi pemasukan otomatis tercatat dengan sumber
      </section>

      <!-- ===== LAPORAN ===== -->
      <section id="laporan" class="section">
        <h2>Laporan & Rekap</h2>
        <div class="toolbar">
          <select id="modeRekap" onchange="tampilRekap()">
            <option value="hari">Per Hari</option>
            <option value="minggu">Per Minggu</option>
            <option value="bulan" selected>Per Bulan</option>
            <option value="tahun">Per Tahun</option>
          </select>
          <button onclick="exportExcel()">Export Excel</button>
        </div>
        <div class="table-wrap">
          <table id="rekapTable">
            <thead>
              <tr>
                <th>Periode</th>
                <th>Nama Pembayar</th>
                <th>Sumber Pembayaran</th>
                <th>Pemasukan</th>
                <th>Pengeluaran</th>
                <th>Saldo</th>
              </tr>
            </thead>
            <tbody id="rekapBody"></tbody>
          </table>
        </div>
      </section>
    </main>
  </div>

  <!-- PENTING: hanya 1 module -->
  <script type="module" src="script.js"></script>
</body>
</html>
