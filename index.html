<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kas Kelas IF 24-A — Dashboard</title>
  <link rel="icon" href="assets/logo.png" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Export Excel & PDF -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js"></script>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="firebase.js"></script>
</head>
<body class="bg">
  <header class="topbar">
    <div class="brand">
      <img src="assets/logo.png" alt="Logo" />
      <span>Kas Kelas IF 24-A — UBP Karawang</span>
    </div>
    <nav class="menu">
      <a class="active" data-page="transaksi">Transaksi</a>
      <a data-page="qris">Pengajuan QRIS</a>
      <a data-page="rekap">Rekap</a>
      <a data-page="anggota">Anggota</a>
      <a data-page="pengaturan">Pengaturan</a>
    </nav>
    <div class="userbox">
      <span id="whoami">—</span>
      <button id="logout" class="btn small">Keluar</button>
    </div>
  </header>

  <main class="wrap">
    <section class="stats">
      <div class="stat"><div class="stat-title">Saldo</div><div class="stat-value" id="saldo">Rp 0</div></div>
      <div class="stat"><div class="stat-title">Iuran Mingguan</div><div class="stat-value" id="iuranLabel">Rp 5.000</div></div>
      <div class="stat"><div class="stat-title">Periode</div><div class="stat-value" id="periodeInfo">—</div></div>
    </section>

    <!-- TRANSAKSI -->
    <section id="page-transaksi" class="page active">
      <div class="toolbar">
        <div class="group admin-only" id="adminActions">
          <button class="btn primary" id="btnAddCash">+ Setoran</button>
          <button class="btn" id="btnPengeluaran">- Pengeluaran</button>
        </div>
        <div class="group">
          <button class="btn" id="btnQRIS">+ QRIS (Ajukan)</button>
          <input id="search" class="input" placeholder="Cari nama/username/catatan..." />
          <select id="selBulan" class="input" style="max-width:140px"></select>
          <select id="selTahun" class="input" style="max-width:120px"></select>
          <button class="btn" id="exportExcel">Excel</button>
          <button class="btn" id="exportPDF">PDF</button>
          <button class="btn admin-only" id="btnResetAll" title="Reset semua transaksi">♻ Reset</button>
        </div>
      </div>

      <div class="card">
        <table class="table" id="tblTransaksi">
          <thead>
            <tr>
              <th>Tanggal</th><th>Nama</th><th>Jenis</th><th>Metode</th>
              <th class="right">Nominal</th><th>Catatan</th><th>Status</th><th style="width:120px">Aksi</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
        <div id="empty" class="empty">Belum ada transaksi.</div>
      </div>
    </section>

    <!-- PENGAJUAN QRIS (ADMIN konfirmasi) -->
    <section id="page-qris" class="page">
      <div class="card">
        <div class="legend">Admin mengonfirmasi pengajuan QRIS dari anggota.</div>
        <table class="table">
          <thead><tr><th>Tanggal</th><th>Nama</th><th>Nominal</th><th>Catatan</th><th>Status</th><th>Aksi</th></tr></thead>
          <tbody id="tbodyQRIS"></tbody>
        </table>
      </div>
    </section>

   <!-- REKAP -->
    <section id="page-rekap" class="page">
      <div class="card">
        <div class="flex gap">
          <select id="rekapScope" class="input" style="max-width:160px">
            <option value="bulan" selected>Bulanan</option>
            <option value="tahun">Tahunan</option>
          </select>
          <select id="rekapBulan" class="input" style="max-width:140px"></select>
          <select id="rekapTahun" class="input" style="max-width:120px"></select>
          <select id="filterStatus" class="input" style="max-width:150px">
            <option value="all" selected>Semua Status</option>
            <option value="lunas">Sudah Lunas</option>
            <option value="belum">Belum Lunas</option>
          </select>
          <button class="btn" id="btnRefreshRekap">Terapkan</button>
          <input id="cariNamaRekap" class="input" placeholder="Cari nama..." />
          <button class="btn" id="exportRekapPDF">PDF</button>
        </div>
        <div class="legend" id="rekapTargetInfo"></div>
        <table class="table" id="tblRekap">
          <thead><tr><th>Nama</th><th>Terbayar</th><th>Sisa</th><th>Status</th></tr></thead>
          <tbody id="tbodyRekap"></tbody>
        </table>
      </div>
    </section>


    <!-- ANGGOTA -->
    <section id="page-anggota" class="page">
      <div class="card">
        <div class="toolbar">
          <div class="group admin-only"><button id="btnTambahAnggota" class="btn">+ Tambah Anggota</button></div>
          <div class="group"><input id="cariAnggota" class="input" placeholder="Cari anggota..." /></div>
        </div>
        <table class="table">
          <thead><tr><th>NIM</th><th>Nama</th><th>Email</th><th>Role</th><th>Aksi</th></tr></thead>
          <tbody id="tbodyAnggota"></tbody>
        </table>
      </div>
    </section>

        <!-- PENGATURAN -->
    <section id="page-pengaturan" class="page">
      <div class="card small">
        <h3>Pengaturan Iuran & QRIS</h3>
        <div class="grid2">
          <label>Iuran Mingguan (Rp)
            <input id="setIuran" class="input" type="number" min="0" />
          </label>
          <label>Tanggal Mulai Minggu (opsional)
            <input id="setStart" class="input" type="date" />
          </label>
        </div>
        <div class="flex gap" style="margin-top:8px">
          <button class="btn primary admin-only" id="btnSimpanPengaturan">Simpan</button>
          <button class="btn" id="btnReloadPengaturan">Muat Ulang</button>
        </div>
        <div class="hr"></div>
        <h4>QRIS Kelas</h4>
        <p class="muted">Scan QR berikut lalu ajukan pembayaran dari tombol “+ QRIS (Ajukan)”.</p>
        <img src="assets/qris.jpg" alt="QRIS" class="qris" />
      </div>
    </section>
  </main>

  <footer class="footer">© UBP — Kas Kelas IF 24-A</footer>

  <!-- SCRIPT DI AKHIR -->
  <script src="script.js"></script>
</body>
</html>
