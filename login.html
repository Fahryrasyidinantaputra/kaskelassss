<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kas Kelas IF 24-A ‚Äî Login</title>
  <link rel="icon" href="assets/logo.png" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="firebase.js"></script>

  <style>
    body{font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:linear-gradient(145deg,#e9f0ff,#f6f8fb);height:100vh;display:flex;align-items:center;justify-content:center;margin:0}
    .card{width:360px;background:#fff;border-radius:18px;padding:32px;box-shadow:0 12px 30px rgba(13,110,253,.18);text-align:center}
    .brand{display:flex;flex-direction:column;align-items:center;margin-bottom:16px}
    .brand img{width:72px;height:72px;border-radius:50%;box-shadow:0 6px 16px rgba(0,0,0,.08)}
    h2{margin:10px 0 2px;font-size:22px}
    p{margin:0 0 14px;color:#667085;font-size:13px}
    label{display:block;text-align:left;font-weight:600;font-size:13px;color:#344054;margin-top:8px}
    input{width:100%;padding:11px;border:1.5px solid #d0d5dd;border-radius:10px;margin-top:4px;font-size:14px}
    input:focus{outline:none;border-color:#0d6efd;box-shadow:0 0 0 3px rgba(13,110,253,.12)}
    .pw-wrap{position:relative}
    .pw-wrap .toggle{position:absolute;right:10px;top:50%;transform:translateY(-50%);cursor:pointer;opacity:.6}
    .btn{width:100%;padding:12px;border:none;border-radius:10px;background:#0d6efd;color:#fff;font-weight:700;margin-top:16px;cursor:pointer}
    .btn:hover{filter:brightness(.95)}
    small{display:block;margin-top:10px;color:#98a2b3}
  </style>
</head>
<body>
  <div class="card">
    <div class="brand">
      <img src="assets/logo.png" alt="Logo">
      <h2>Kas Kelas IF24-A</h2>
      <p>Dashboard kas kelas </p>
    </div>

    <form id="loginForm">
      <label>NIM (username)</label>
      <input id="loginUser" placeholder="NIM anda" />
      <label>Password</label>
      <div class="pw-wrap">
        <input id="loginPass" type="password" placeholder="namaif24a" />
        <span id="togglePw" class="toggle">üëÅ</span>
      </div>
      <button type="button" id="btnLogin" class="btn">Masuk</button>
    </form>
  </div>

  <script>
    const toast = (icon, text) => Swal.fire({icon, text, timer:1400, showConfirmButton:false});

    // Seed ADMIN (sekali)
    db.ref('users/admin').once('value', s=>{
      if(!s.exists()){
        db.ref('users/admin').set({ nama:'Administrator', username:'admin', password:'12345', role:'admin', aktif:true });
      }
    });

    // Toggle üëÅ
    document.getElementById('togglePw').onclick=()=>{
      const p=document.getElementById('loginPass');
      p.type = p.type==='password'?'text':'password';
    };

    // Login
    document.getElementById('btnLogin').onclick=()=>{
      const u = loginUser.value.trim();
      const p = loginPass.value.trim();
      if(!u||!p) return toast('warning','Lengkapi username & password');
      db.ref('users/'+u).once('value', snap=>{
        if(!snap.exists()) return toast('error','Username tidak ditemukan');
        const user = snap.val();
        if(user.password!==p) return toast('error','Password salah');
        if(user.aktif===false) return toast('error','Akun nonaktif');
        localStorage.setItem('activeUser', JSON.stringify(user));
        toast('success','Login berhasil'); setTimeout(()=>location.href='index.html',350);
      });
    };
  </script>
</body>
</html>
