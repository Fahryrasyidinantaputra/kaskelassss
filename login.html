<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Kas Kelas IF 24-A — Login</title>
  <link rel="icon" href="assets/logo.png" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

  <!-- Firebase v8 -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-storage.js"></script>
  <script src="firebase.js"></script>
</head>
<body class="bg">
  <header class="topbar">
    <div class="brand">
      <img src="assets/logo.png" alt="Logo" />
      <span>Kas Kelas IF 24-A — UBP Karawang</span>
    </div>
  </header>

  <main class="center">
    <div class="card login-card">
      <h2>Masuk / Daftar</h2>
      <p class="muted">Dashboard kas kelas modern & real-time</p>

      <div class="tabs" style="margin-bottom:8px">
        <button class="tab active" data-tab="login">Login</button>
        <button class="tab" data-tab="signup">Daftar</button>
      </div>

      <!-- LOGIN -->
      <form id="loginForm" class="panel active formcol">
        <label>NIM (username)</label>
        <input id="loginUser" placeholder="24416255xxxxx" />
        <label>Password</label>
        <input id="loginPass" type="password" placeholder="email kampus" />
        <button type="button" class="btn primary full" id="btnLogin">Masuk</button>
        <small class="muted">Admin: <b>admin</b> / <b>12345</b></small>
      </form>

      <!-- SIGNUP -->
      <form id="signupForm" class="panel formcol">
        <label>Nama Lengkap</label>
        <input id="regNama" placeholder="Nama lengkap" />
        <label>NIM (username)</label>
        <input id="regUser" placeholder="24416255xxxxx" />
        <label>Email Kampus (jadi password awal)</label>
        <input id="regEmail" placeholder="if24.nama@mhs.ubpkarawang.ac.id" />
        <button type="button" class="btn full" id="btnSignup">Daftar Anggota</button>
      </form>
    </div>
  </main>

  <footer class="footer">© UBP — Kas Kelas IF 24-A</footer>

  <script>
    const toast = (icon, text) => Swal.fire({icon, text, timer:1400, showConfirmButton:false});

    // Tabs
    document.querySelectorAll('.tab').forEach(b=>{
      b.onclick=()=>{
        document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
        b.classList.add('active');
        document.querySelectorAll('.panel').forEach(x=>x.classList.remove('active'));
        document.getElementById(b.dataset.tab==='login'?'loginForm':'signupForm').classList.add('active');
      };
    });

    // Seed ADMIN
    db.ref('users/admin').once('value', s=>{
      if(!s.exists()){
        db.ref('users/admin').set({ nama:'Administrator', username:'admin', password:'12345', role:'admin', aktif:true });
      }
    });

    // Seed IF 24-A (sekali saja)
    const IF24A = [
      ["24416255201207","Habiburrohman Azzami","if24.habiburrohmanazzami@mhs.ubpkarawang.ac.id"],
      ["24416255201205","Tiara Putri Aulia","if24.tiaraaulia@mhs.ubpkarawang.ac.id"],
      ["24416255201133","Rakha Rafid Fahrezi","if24.rakhafahrezi@mhs.ubpkarawang.ac.id"],
      ["24416255201004","Indah Rahmawati","if24.indahrahmawati@mhs.ubpkarawang.ac.id"],
      ["24416255201204","Anwar Ramadhan","if24.anwarramadhan@mhs.ubpkarawang.ac.id"],
      ["24416255201068","Agga Pratama Putra","if24.anggaputra@mhs.ubpkarawang.ac.id"],
      ["24416255201209","Rio Rasyha Syadzily","if24.riosyadzily@mhs.ubpkarawang.ac.id"],
      ["24416255201010","Mohamad Hilmy Haidar","if24.mohamadhaidar@mhs.ubpkarawang.ac.id"],
      ["24416255201237","Dimaz Wahyudy","if24.dimazwahyudy@mhs.ubpkarawang.ac.id"],
      ["24416255201215","Suci Nur Saffrilia Dewi","if24.sucidewi@mhs.ubpkarawang.ac.id"],
      ["24416255201230","Fairuz Putra Sema","if24.fairuzsema@mhs.ubpkarawang.ac.id"],
      ["24416255201124","Septian Eka Putra","if24.septianputra@mhs.ubpkarawang.ac.id"],
      ["24416255201110","Daffa Andhika Pratama","if24.daffapratama@mhs.ubpkarawang.ac.id"],
      ["24416255201213","Aan Ripandi","if24.aanripandi@mhs.ubpkarawang.ac.id"],
      ["24416255201075","Ahmad Arifin","if24.ahmadarifin@mhs.ubpkarawang.ac.id"],
      ["24416255201212","Alfi Latifatul Munawaroh","if24.alfilatifatul@mhs.ubpkarawang.ac.id"],
      ["24416255201115","Nur Mukhlisin","if24.nurmukhlisin@mhs.ubpkarawang.ac.id"],
      ["24416255201123","Dannys Panji Kurniawan","if24.dannyskurniawan@mhs.ubpkarawang.ac.id"],
      ["24416255201032","Alyaluna Sasmita","if24.alyalunasasmita@mhs.ubpkarawang.ac.id"],
      ["24416255201233","Muhammad Hilal Al Mufid","if24.muhammadmufid@mhs.ubpkarawang.ac.id"],
      ["24416255201203","Fahry Rasyidinanta Putra","if24.fahryputra@mhs.ubpkarawang.ac.id"],
      ["24416255201211","Sekar Listyana Kartika","if24.sekarkartika@mhs.ubpkarawang.ac.id"],
      ["24416255201043","Atila Faturrahman Pratama","if24.atilapratama@mhs.ubpkarawang.ac.id"],
      ["24416255201235","Muhammad Fadhil Alhakim","if24.muhammadalhakim@mhs.ubpkarawang.ac.id"],
      ["24416255201056","Muhammad Dzikri Agam Abdul Halim","if24.muhammadhalim@mhs.ubpkarawang.ac.id"],
      ["24416255201208","Agry Septiani Arifin","if24.agryarifin@mhs.ubpkarawang.ac.id"]
    ];
    db.ref('meta/seed_if24a_done').once('value').then(s=>{
      if(s.val()) return;
      const updates={};
      IF24A.forEach(([nim,nama,email])=>{
        updates['/users/'+nim] = {username:nim, nama, email, password:email, role:'anggota', aktif:true};
      });
      db.ref().update(updates).then(()=> db.ref('meta/seed_if24a_done').set(true));
    });

    // LOGIN (NIM + email)
    document.getElementById('btnLogin').onclick=()=>{
      const u = document.getElementById('loginUser').value.trim();
      const p = document.getElementById('loginPass').value.trim();
      if(!u||!p) return toast('warning','Lengkapi username & password');

      db.ref('users/'+u).once('value', snap=>{
        if(!snap.exists()) return toast('error','Username tidak ditemukan');
        const user=snap.val();
        if(user.password!==p) return toast('error','Password salah');
        if(user.aktif===false) return toast('error','Akun nonaktif');
        localStorage.setItem('activeUser', JSON.stringify(user));
        toast('success','Login berhasil'); setTimeout(()=>location.href='index.html',350);
      });
    };

    // SIGNUP (opsional)
    document.getElementById('btnSignup').onclick=()=>{
      const nama=document.getElementById('regNama').value.trim();
      const user=document.getElementById('regUser').value.trim();
      const email=document.getElementById('regEmail').value.trim();
      if(!nama||!user||!email) return toast('warning','Lengkapi semua data');
      db.ref('users/'+user).once('value', s=>{
        if(s.exists()) return toast('error','NIM sudah terdaftar');
        db.ref('users/'+user).set({ nama, username:user, email, password:email, role:'anggota', aktif:true })
        .then(()=>{ toast('success','Akun dibuat. Silakan login.'); document.querySelector('.tab[data-tab="login"]').click(); });
      });
    };
  </script>
</body>
</html>
